<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Aecie Map Based on Baidu</title>
	<script type="text/javascript" src = "//api.map.baidu.com/api?v=2.0&ak=Cq1UWYjYILQkz99rehq2Rsq7pkIxPDib"></script>
	<script type="text/javascript" src = "https://cdn.staticfile.org/vue/2.4.2/vue.min.js" ></script>
	<script type="text/javascript" src = "../JQuery.js" ></script>
</head>
<body>
	<!-- Maps Generation -->
	<div id = "ac_map" style = "border:#ccc solid 5px; position: absolute; right: 0%; top: 0%; bottom: 0%; left: 380px;"></div>

	<!-- Direction -->
	<div id = "object" style = "background-color: rgb(66, 133, 244); position: absolute; top: 0; left: 0; bottom: 0%; width: 380px;">
		<!-- Title -->
		<h1 style = "color: white; text-align: center; font-size: 30px; position: relative; top: 20px;">Aecie Map of Info</h1>
		<!-- Search -->
		<div style = "background-color: rgb(51, 103, 214); position: absolute; width: 304px; height: 40px; left: 38px; border-radius: 5px; top: 120px;" >
			<h1 style = "color: white; position: relative; left: 15px; top: -5px; font-weight: normal; font-size: 20px"> Locate: </h1>
			
			<input id = "cityName" type="text" value = "where to go" style="position: relative; width:170px; top: -45px; left:90px; color: white; font-size: 17px; border-bottom: white 1px solid; border-top-style: none; border-right-style: none; border-left-style: none; background-color: transparent;">

			<img id = "Locate" src = "image/search.png" width = "20" height = "20" onclick = "theLocation()" style = "cursor: pointer; position: relative; top: -40px; left: 100px;">
		</div>

		<div id = "Info" style = "background-color: rgb(51, 103, 214); border-radius: 5px; position: absolute; top: 200px; left: 38px; width: 200px; height: 105px; display: none;">
			<div id = "format" style = "color: white; position: relative; left: 20px; top: 10px;"></div>	
		</div>
		
		<div style = "background-color: rgb(51, 103, 214); position: absolute; width: 200px; height: 40px; left: 38px; bottom: 40px; border-radius: 5px;">
			<img src="image/return.png" width="20" height="20" style = "position: absolute; left: 15px; top: 10px;">
			<a href="../index.html" style = "position: absolute; left: 50px; top: 8px; text-decoration: none; color: white; font-size: 20px; font-weight: normal;"> Return Home </a>
		</div>
	</div>
</body>
	<script name = "map" type = "text/javascript">
		"use strict";
		var map = new BMap.Map("ac_map");
		var point = new BMap.Point(116.331398,39.897445);
		// var weatherData = null;
		var html = "";

		map.centerAndZoom(point,13);
		
		map.enableDragging();
		map.enableScrollWheelZoom();
		map.enableDoubleClickZoom();
		map.enableKeyboard();
		
		map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_LEFT, type: BMAP_NAVIGATION_CONTROL_LARGE}));
		map.addControl(new BMap.OverviewMapControl({anchor: BMAP_ANCHOR_BOTTOM_RIGHT, isOpen: 0}));
		map.addControl(new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT}));

		function myLoc(result){
			var cityName = result.name;
			map.setCenter(cityName);
			alert("Now you are located in " + cityName);
		}

		var myCity = new BMap.LocalCity();
		myCity.get(myLoc);

		$(document).ready(function(){
			$("#Locate").click(function(){
				$("#Info").fadeIn();
			});
		});

		function theLocation(){
			var city = $("#cityName").val();
			if(city != ""){
				map.centerAndZoom(city,11);      // 用城市名设置地图中心点

			}

			getCityById(city);
		//	console.log("weatherData: "+weatherData);
		//	console.log();
		}


		function format(result){
			var week = "";
			switch(result.week){
				case "星期一": week = "Monday"; break;
				case "星期二": week = "Tuesday"; break;
				case "星期三": week = "Wednesday"; break;
				case "星期四": week = "Thursday"; break;
				case "星期五": week = "Friday"; break;
				case "星期六": week = "Saturday"; break;
				default: week = "Sunday"; break;
			}

			var wea = "";
			switch(result.wea_img){
				case "bingbao": wea = "<img src=\"image/yu.png\" width=\"15\" height=\"15\" > hail"; break;
				case "lei": wea = "<img src=\"image/lei.png\" width=\"15\" height=\"15\" > thunder"; break;
				case "qing": wea = "<img src=\"image/qing.png\" width=\"15\" height=\"15\" > sunny"; break;
				case "shachen": wea = "<img src=\"image/shachen.png\" width=\"15\" height=\"15\" > sandy"; break;
				case "wu": wea = "<img src=\"image/wu.png\" width=\"15\" height=\"15\" > foggy"; break;
				case "xue": wea = "<img src=\"image/xue.png\" width=\"15\" height=\"15\" > snowy"; break;
				case "yin": wea = "<img src=\"image/yin.png\" width=\"15\" height=\"15\" > overcast"; break;
				case "yu": wea = "<img src=\"image/yu.png\" width=\"15\" height=\"15\" > rainy"; break;
				case "yujiaxue": wea = "<img src=\"image/yujiaxue.png\" width=\"15\" height=\"15\" > sleet"; break;
				default: wea = "<img src=\"image/yun.png\" width=\"15\" height=\"15\" > cloudy"; break;
			}

			html = "Date: " + result.date + "</br>" +
			"Day: " + week + "</br>" +
			"Weather: " + wea + "</br>" + 
			result.tem2 + "~" + result.tem1;
			$("#format").empty();
			$("#format").append(html);
		}

		function request(cityId){
			$.ajax({
		        type: 'GET',
		        url: 'https://www.tianqiapi.com/api/',
		        //url: 'http://api.wunderground.com',
		        data: 'version=v1&cityid='+cityId+'&appid=[75248442]&appsecret=[qMnlL1Fj]',
		        dataType: 'JSON',
		        error: function () {
		            alert('网络错误');
		        },
		        success: function (res) {
		            console.log(res.data[0]);
		            format(res.data[0]);
		            // weatherData = res.data[1].date;
		            // console.log("Data: "+weatherData)
		            
		        }
	      	});
		}
		

		function getCityById(cityName){
			$.getJSON('https://yiyingcanfeng.github.io/data/2019-03-13-cn_weather_citylist.json', function (res) {
		        for (var i = 0; i < res.length; i++) {
		        	if (res[i].cityName === cityName) {

		        		console.log("cityName: "+res[i].cityCode)
		            	request(res[i].cityCode);
		        	}
		        }
	     	})
		}
	</script>

	<!-- <script name = "vue-js" type="text/javascript">
		var vm = new Vue({
			el: '#object',
			data: {
				title: "Aecie Map of Info",
				query: "Locate:",

			},
		})
	</script> -->
</html>
