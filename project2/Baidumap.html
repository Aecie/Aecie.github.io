<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Aecie Map Based on Baidu</title>
	<script type="text/javascript" src = "//api.map.baidu.com/api?v=2.0&ak=Cq1UWYjYILQkz99rehq2Rsq7pkIxPDib"></script>
	<script type="text/javascript" src = "../JQuery.js" ></script>
	<style type="text/css">
		button{
			position: relative;
			top: 10px;
			left: 20px;
			color: white;
			background-color: transparent;
			border: 0;
			cursor: pointer;
			font-size: 20px;
			display: inline-block;
			margin: auto;
		}
	</style>
</head>
<body>
	<!-- Maps Generation -->
	<div id = "ac_map" style = "border:#ccc solid 5px; position: absolute; right: 0%; top: 0%; bottom: 0%; left: 380px;"></div>

	<!-- Direction -->
	<div id = "object" style = "background-color: rgb(66, 133, 244); position: absolute; top: 0; left: 0; bottom: 0%; width: 380px;">
		<!-- Title -->
		<h1 style = "color: white; text-align: center; font-size: 30px; position: relative; top: 20px;">Aecie Weather Map</h1>
		<!-- Search -->
		<div style = "background-color: rgb(51, 103, 214); position: absolute; width: 304px; height: 40px; left: 38px; border-radius: 5px; top: 120px;">
			<h1 style = "color: white; position: relative; left: 15px; top: -5px; font-weight: normal; font-size: 20px"> Locate: </h1>
			
			<input id = "cityName" type="text" value = "where to go" style="position: relative; width:170px; top: -45px; left:90px; color: white; font-size: 17px; border-bottom: white 1px solid; border-top-style: none; border-right-style: none; border-left-style: none; background-color: transparent;">

			<img id = "Locate" src = "image/search.png" width = "20" height = "20" onclick = "theLocation()" style = "cursor: pointer; position: relative; top: -40px; left: 100px;">
		</div>

		<!-- information frame -->
		<div id = "image" style = "background-color: rgb(51, 103, 214); border-radius: 5px; position: absolute; top: 200px; left: 38px; width: 304px; height: 200px; text-align: center; display: none;">
		</div>
		
		<div id = "Info" style = "background-color: rgb(51, 103, 214); border-radius: 5px; position: absolute; top: 440px; left: 38px; width: 304px; height: 300px; display: none;">
			<button id="now" onclick="getData('now', 0, cityName())">Now</button>
			<button id="Tomorrow" onclick="getData('forecast', 1, cityName())">Tomorrow</button>
			<button id="Acquired" onclick="getData('forecast', 2, cityName())">Acquired</button>
			<div id = "format" style = "color: white; position: relative; left: 20px; top: 40px;"></div>	
		</div>
		
		<!-- return home -->
		<div style = "background-color: rgb(51, 103, 214); position: absolute; width: 200px; height: 40px; left: 38px; bottom: 40px; border-radius: 5px;">
			<img src="image/return.png" width="20" height="20" style = "position: absolute; left: 15px; top: 10px;">
			<a href="../index.html" style = "position: absolute; left: 50px; top: 8px; text-decoration: none; color: white; font-size: 20px; font-weight: normal;"> Return Home </a>
		</div>


	</div>
</body>
	<script name = "map" type = "text/javascript">
		// Map API
		var map = new BMap.Map("ac_map");
		var point = new BMap.Point(116.331398,39.897445);

		map.centerAndZoom(point,13);
				
		map.enableDragging();
		map.enableScrollWheelZoom();
		map.enableDoubleClickZoom();
		map.enableKeyboard();
				
		map.addControl(new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_LEFT, type: BMAP_NAVIGATION_CONTROL_LARGE}));
		map.addControl(new BMap.OverviewMapControl({anchor: BMAP_ANCHOR_BOTTOM_RIGHT, isOpen: 0}));
		map.addControl(new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT}));
		
		$("body").keydown(function(){
			if(event.keyCode == "13")
				$("#Locate").click();
		});
		
		function myLoc(result){
			var cityName = result.name;
			map.setCenter(cityName);
			alert("Now you are located in " + cityName);
		}
		var myCity = new BMap.LocalCity();
		myCity.get(myLoc);

		function theLocation(){
			var city = cityName();
			if(city != ""){
				map.centerAndZoom(city,11);
			}

			getData('now', 0, city);
		}
		function cityName(){
			return $("#cityName").val();
		}

		//HeWeather
		function getData(type, num, location){
			$.ajax({
				type: 'GET',
				url: 'https://free-api.heweather.net/s6/weather/'+type+'?',
				data: 'key=18a60ead4caa4d4f89059dc3e2895cf4	&location='+location+'&lang=en&username=HE1911250915131178',
				dataType: 'JSON',
				error: function(){
					alert('Network error!');
				},
				success: function(response){
					if(response.HeWeather6[0].status == "unknown location"){
						alert("The location is undefined in weather API!");
						return;
					}
					console.log(response);
					if(type == 'now')
						htmlCurrentData(type, response.HeWeather6[0].now);
					else if(type == 'forecast')
						htmlCurrentData(type, response.HeWeather6[0].daily_forecast[num]);
				}
			});
		}

		function htmlCurrentData(type, response){
			if(type == 'now'){
				var html = "<img src=\"image/attributes/weather.png\" width=\"15\" height=\"15\">  Weather: " + response.cond_txt + "</br>" +
				"<img src=\"image/attributes/temp.png\" width=\"15\" height=\"15\">  Temperature: " + response.tmp + "℃</br>" +
				"<img src=\"image/attributes/feeling.png\" width=\"15\" height=\"15\">  Feeling: " + response.fl + "℃</br>" +
				"<img src=\"image/attributes/humidity.png\" width=\"15\" height=\"15\">  Humidity: " + response.hum + "%</br>" +
				"<img src=\"image/attributes/press.png\" width=\"15\" height=\"15\">  Press: " + response.pres + "</br>" +
				"<img src=\"image/attributes/precipitation.png\" width=\"15\" height=\"15\">  Precipitation: " + response.pcpn + "</br>" +
				"<img src=\"image/attributes/visibility.png\" width=\"15\" height=\"15\">  Visibility: " + response.vis + "km</br>" +
				"<img src=\"image/attributes/dir.png\" width=\"15\" height=\"15\">  Wind Direction: " + response.wind_dir + "</br>" +
				"<img src=\"image/attributes/spd.png\" width=\"15\" height=\"15\">  Wind Speed: " + response.wind_spd + "km/h</br>";

				$("#image").empty();
				$("#image").fadeIn();
				$("#Info").fadeIn();
				$("button").fadeIn();
				$("#format").empty();
				$("#image").append(
					codeToImg(1, response.cond_code) + 
					"<div style=\"color: white; font-weight: bold;\">Now</div>"
					);
				$("#format").append(html);
			}

			else if(type == 'forecast'){
				var html = "<img src=\"image/attributes/date.png\" width=\"15\" height=\"15\">  Date: " + response.date + "</br>" +
				"<img src=\"image/attributes/day.png\" width=\"15\" height=\"15\">  Day Weather: " + response.cond_txt_d + "</br>" +
				"<img src=\"image/attributes/night.png\" width=\"15\" height=\"15\">  Night Weather: " + response.cond_txt_n + "</br>" +
				"<img src=\"image/attributes/humidity.png\" width=\"15\" height=\"15\">  Humidity: " + response.hum + "%</br>" +
				"<img src=\"image/attributes/press.png\" width=\"15\" height=\"15\">  Press: " + response.pres + "</br>" +
				"<img src=\"image/attributes/precipitation.png\" width=\"15\" height=\"15\">  Precipitation: " + response.pcpn + "</br>" +
				"<img src=\"image/attributes/visibility.png\" width=\"15\" height=\"15\">  Visibility: " + response.vis + "km</br>" +
				"<img src=\"image/attributes/dir.png\" width=\"15\" height=\"15\">  Wind Direction: " + response.wind_dir + "</br>" +
				"<img src=\"image/attributes/spd.png\" width=\"15\" height=\"15\">  Wind Speed: " + response.wind_spd + "km/h</br>" +
				"<img src=\"image/attributes/uv.png\" width=\"15\" height=\"15\">  UV Index: " + response.uv_index + "</br>";

				$("#image").empty();
				$("#image").fadeIn();
				$("#Info").fadeIn();
				$("button").fadeIn();
				$("#format").empty();
				$("#image").append(
					codeToImg(1, response.cond_code_d) + 
					codeToImg(0, response.cond_code_n) +
					"<div style=\"color: white; font-weight: bold; position: absolute; left: 65px;\">Day</div>" +
					"<div style=\"color: white; font-weight: bold; position: absolute; right: 65px;\">Night</div>"
					);
				$("#format").append(html);
			}

			else{
				$("#image").hide();
				$("Info").hide();
				$("button").hide();
				$("#format").hide();
			}
		}

		// 1 for day, 0 for night;
		function codeToImg(num, code){
			if(num == 1)
				return "<img src=\"image/weathers/"+code+".png\" width=\"145\" height=\"145\">";
			else{
				if(code == "100" || code == "103" || code == "104" || code == "300" || code == "301" || code == "406" || code == "407")
					return "<img src=\"image/weathers/"+code+"n.png\" width=\"145\" height=\"145\">";
				else
					return "<img src=\"image/weathers/"+code+".png\" width=\"145\" height=\"145\">";
			}
		}
	</script>
</html>
