<!DOCTYPE html>
<html xmlns:mce = "http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="百度地图,百度地图API，百度地图自定义工具，百度地图所见即所得工具" />
<meta name="description" content="百度地图API自定义地图，帮助用户在可视化操作下生成百度地图" />
<title>百度地图API自定义地图</title>
<!--引用百度地图API-->
<style type="text/css">
    .top{
             
            color:#0066FF;
            height:53px;
            margin:0px auto;
            padding:0;
            width:980px;}
    .topContent{
            background:none repeat scroll 0 0 #F5F9FC;
            margin-top:10px;
            text-align:center;
            height:32px;
            width:980px;
            font-weight:bold;
            font-size:20px;
    }
    .dituContent{
            width:980px;
            height:530px;
            border:#ccc solid 1px;
            margin:0 auto;
            padding:0;
    }
</style>
<mce:script type="text/javascript" src="http://api.map.baidu.com/api?v=1.1&services=true" mce_src="http://api.map.baidu.com/api?v=1.1&services=true">
    
</mce:script>
</head>
 
<body>
<div class="top">
    <div class="topContent">
         地图形式天气预报
    </div>
</div>
   <!--百度地图容器-->
    <div class="dituContent" id="dituContent"></div>
 
</body>

<script type="text/javascript">
    //创建和初始化地图函数：
    function initMap(){
        createMap();//创建地图
        setMapEvent();//设置地图事件
    //    searchPoint();//搜索地点
    }
     
    //创建地图函数：
    function createMap(){
        var map = new BMap.Map("dituContent");//在百度地图容器中创建一个地图
        var point = new BMap.Point(108.953098,34.2778);//定义一个中心点坐标
        map.centerAndZoom(point,5);//设定地图的中心点和坐标并将地图显示在地图容器中
        window.map = map;//将map变量存储在全局
    }
     
    //地图事件设置函数：
    function setMapEvent(){
        map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
      //  map.enableScrollWheelZoom();//启用地图滚轮放大缩小
     //   map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
        map.disableDoubleClickZoom();
        //map.enableKeyboard();//启用键盘上下左右键移动地图
    }
    //地图点搜索函数：
    function searchPoint(){
    var citys=new Array("北京","上海","天津","重庆","哈尔滨","长春","沈阳","呼和浩特","石家庄","郑州","济南","太原","南京","合肥","西安","银川","兰州","西宁","武汉","长沙","杭州","南昌","福州","贵阳","成都","广州","南宁","昆明","海口","乌鲁木齐","拉萨","台北","香港","澳门");
 
         for (x in citys)
         {
            getWeatherByName(citys[x]);
         }
     
    }
    //根据城市名称得到天气信息
    function getWeatherByName(cityname){
             
/************************创建XMLHttpRequest对象实例代码*******************************/
 
//创建一个布尔型变量，用来检查是否为有效的IE实例。
 
var xmlhttp = false;
//检查是否使用的是IE
try{
    //如果JavaScript的版本大于5
    xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
}catch (e) {
    //如果不是，则使用老版本的Active X 对象
    try{
        //如果使用的是IE浏览器
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }catch (E) {
       //否则肯定使用的是非IE浏览器
        xmlhttp = false;
    }
}
//如果使用的是非IE浏览器，则创建一个该对象的JavaScript实例
if (!xmlhttp && typeof XMLHttpRequest != "undefinded")
{
    xmlhttp = new XMLHttpRequest();
}
/**********************************************************************************/
 
var serverPage = "weather/weather.php?a="+cityname+"&tmp="+Math.random();
               xmlhttp.open("GET",encodeURI(serverPage));
               xmlhttp.onreadystatechange=function(){
                            
                           if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                           {
                                 
                                searchPointByName(cityname,xmlhttp.responseText);
                           }
               }
               xmlhttp.send(null);
}

//根据城市名称搜索,并显示天气信息窗口：
    function searchPointByName(cityname,content){
            var options = {
                onSearchComplete: function(results){
                        if (local.getStatus() == BMAP_STATUS_SUCCESS){
                        // 判断状态是否正确
                        var markerPoint=results.getPoi(0).point;//得到标注点坐标
                        var marker = new BMap.Marker(markerPoint);        // 创建标注
                            map.addOverlay(marker);                          // 将标注添加到地图中
                             
                            var opts = {
                                 width : 400,     // 信息窗口宽度
                                  height: 160,     // 信息窗口高度
                                  title : cityname  // 信息窗口标题
                                }
                            var infoWindow = new BMap.InfoWindow(content, opts);  // 创建信息窗口对象,content为显示天气信息的html语句
                            marker.addEventListener("click", function(){                                        
                                            this.openInfoWindow(infoWindow);        
                                            });
 
                                }
                    }
                };
 
 
    var local = new BMap.LocalSearch(map, options);
                        local.enableFirstResultSelection();
                        local.search(cityname);
                     
    }
    initMap();//创建和初始化地图
</script>
</html>